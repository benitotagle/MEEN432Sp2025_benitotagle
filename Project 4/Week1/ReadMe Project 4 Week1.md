To run the code:

* Open Simulink model "Project4\_Simulink” to ensure it is accessible.  
* Run the MATLAB script Project4\_main

This project simulates a full vehicle dynamics and energy management model. The driver model implements a pure pursuit controller to determine the appropriate steering angle based on the vehicle's current position and the track centerline. For velocity control, the reference speed is calculated using the curvature of the path and a predefined maximum lateral acceleration from the tire model. This ensures the vehicle remains within safe handling limits when cornering. To account for real-world constraints where the vehicle may go off-track at theoretical limits, a cornering factor is applied to reduce the reference speed in curves. The absolute maximum reference velocity is determined from the gearing, the motor’s maximum RPM, and the wheel radius, which together define the theoretical speed limit of the car on a straight path.

Lateral dynamics are modeled based on tire slip and the resulting lateral tire forces, providing a realistic depiction of how the vehicle turns and maintains stability. For longitudinal dynamics, the reference speed from the curvature-based model is compared to the current vehicle speed using a PID controller. The PID controller outputs a desired torque percentage, which represents the driver's acceleration or braking demand.

This torque percentage is then constrained by what is physically available from both the battery and the motor. The battery model computes available power using its voltage and internal resistance through the equation P \= V^2 / (4R), which represents the peak deliverable power at a given state. This power is then used to calculate the maximum mechanical torque output by the motor, considering drivetrain efficiency. Simultaneously, a motor torque-speed curve is used to determine the maximum torque available at any given motor RPM, allowing the system to always respect motor limits.

The model also implements regenerative braking. When the vehicle is decelerating and its speed is above 5 mph, the control signal from the PID controller transitions into a braking demand. Regenerative braking torque is applied first, capped at 60% of the maximum available motor torque to reflect realistic limits from typical EV systems. Any additional torque needed beyond this is fulfilled through friction brakes. As the vehicle slows down toward zero, the friction braking proportion increases linearly while the regenerative braking is tapered off. This smooth transition helps reflect actual vehicle braking behavior.

Both aerodynamic drag and rolling resistance are modeled as forces at the tire level. The aerodynamic drag is based on vehicle speed, drag coefficient, and frontal area, while rolling resistance is modeled as a constant proportional force. The model also includes a single-stage gearbox, which modifies the torque transmitted to the wheels and accounts for gear inertia. State of charge (SOC) of the battery is tracked over time by integrating the energy consumed, using SOC \= SOC\_initial \- (E\_consumed / (3600 × V × Capacity)) to capture battery depletion in amp-hours.

